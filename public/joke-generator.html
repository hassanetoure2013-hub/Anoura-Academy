<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Joke Generator (vanilla)</title>
    <style>
      body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 2rem; background:#f7fafc; color:#0f172a; }
      .card { max-width:640px; margin:0 auto; padding:1rem; background:#fff; border-radius:8px; box-shadow:0 6px 18px rgba(15,23,42,0.06); }
      .controls { display:flex; gap:0.5rem; margin-top:1rem; }
      button { padding:0.5rem 0.75rem; border-radius:6px; border:none; cursor:pointer; }
    </style>
  </head>
  <body>
    <main class="card" id="app">
      <h3>Random Joke Generator (vanilla)</h3>
      <div id="joke">Loading...</div>
      <div class="controls">
        <button id="new">New joke</button>
        <button id="copy">Copy</button>
      </div>
      <div id="msg" aria-live="polite" style="margin-top:0.5rem;color:#065f46"></div>
    </main>

    <script>
      async function fetchRandomJoke() {
        try {
          const res = await fetch('https://icanhazdadjoke.com/', { headers: { Accept: 'application/json' } });
          if (res.ok) {
            const j = await res.json();
            return { type: 'dad', text: j.joke };
          }
        } catch (e) { /* fallback */ }

        const res2 = await fetch('https://official-joke-api.appspot.com/random_joke');
        if (!res2.ok) throw new Error('Joke API failed');
        const j2 = await res2.json();
        return { type: 'setup', text: j2.setup + '\n' + j2.punchline };
      }

      function copyToClipboardRobust(text) {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          return navigator.clipboard.writeText(text);
        }
        return new Promise((resolve, reject) => {
          try {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            textarea.style.top = '0';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            const ok = document.execCommand('copy');
            document.body.removeChild(textarea);
            if (ok) resolve();
            else reject(new Error('execCommand failed'));
          } catch (err) {
            reject(err);
          }
        });
      }

      const jokeEl = document.getElementById('joke');
      const msgEl = document.getElementById('msg');

      async function load() {
        jokeEl.textContent = 'Loading...';
        msgEl.textContent = '';
        try {
          const j = await fetchRandomJoke();
          jokeEl.textContent = j.text;
        } catch (e) {
          jokeEl.textContent = 'Error fetching joke';
        }
      }

      document.getElementById('new').addEventListener('click', load);
      document.getElementById('copy').addEventListener('click', async () => {
        const text = jokeEl.textContent || '';
        try {
          await copyToClipboardRobust(text);
          msgEl.textContent = 'Copied!';
          setTimeout(() => (msgEl.textContent = ''), 2000);
        } catch {
          msgEl.textContent = 'Copy failed â€” please copy manually';
        }
      });

      void load();
    </script>
  </body>
</html>